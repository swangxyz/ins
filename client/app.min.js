/**
 * Instagram Demo
 * (c) 2015 Steven Wang
 * License: MIT
 * Last Updated: Thu, 01 Oct 2015 06:04:21 GMT
 */
angular.module("Ins",["ngRoute","ngMessages","satellizer","environment"]).config(["$routeProvider","envServiceProvider","$authProvider",function(e,r,t){r.config({domains:{development:["localhost:8080","dev.local"],production:["stevenw.xyz","stevenw.xyz",""]},vars:{development:{serverUrl:"http://localhost:3000",clientUrl:"http://localhost:8080",clientId:"58394c6d6aae436392eb7898d80d33ea"},production:{serverUrl:"https://ins-server.herokuapp.com",clientUrl:"http://stevenw.xyz/ins",clientId:"15eaa20c07e24ce289a9ecf8331c1b2a"}}}),e.when("/",{templateUrl:"view/home.html",controller:"HomeCtrl"}).when("/login",{templateUrl:"view/login.html",controller:"LoginCtrl"}).when("/signup",{templateUrl:"view/signup.html",controller:"SignupCtrl"}).when("/photo/:id",{templateUrl:"view/detail.html",controller:"DetailCtrl"}).otherwise("/"),r.set("production"),$serverUrl=r.read("serverUrl"),$clientUrl=r.read("clientUrl"),$clientId=r.read("clientId"),t.loginUrl=$serverUrl+"/auth/login",t.signupUrl=$serverUrl+"/auth/signup",t.oauth2({name:"interest",url:$serverUrl+"/auth/instagram",redirectUri:$clientUrl,clientId:$clientId,requiredUrlParams:["scope"],scope:["likes"],scopeDelimiter:"+",authorizationEndpoint:"https://api.instagram.com/oauth/authorize"})}]).run(["$rootScope","$window","$auth",function(e,r,t){t.isAuthenticated()&&r.localStorage.currentUser?e.currentUser=JSON.parse(r.localStorage.currentUser):e.currentUser=null}]),angular.module("Ins").controller("DetailCtrl",["$scope","$rootScope","$location","API",function(e,r,t,n){var o=t.path().split("/").pop();n.getMediaById(o).success(function(r){e.hasLiked=r.user_has_liked,e.photo=r}),e.like=function(){e.hasLiked=!0,n.likeMedia(o).error(function(e){sweetAlert("Error",e.message,"error")})}}]),angular.module("Ins").controller("HomeCtrl",["$scope","$window","$rootScope","$auth","API",function(e,r,t,n,o){n.isAuthenticated()&&t.currentUser&&t.currentUser.username&&o.getFeed().success(function(r){e.photos=r}),e.isAuthenticated=function(){return n.isAuthenticated()},e.linkInstagram=function(){n.link("interest").then(function(n){r.localStorage.currentUser=JSON.stringify(n.data.user),t.currentUser=JSON.parse(r.localStorage.currentUser),o.getFeed().success(function(r){e.photos=r})["catch"](function(e){console.log(e)})})}}]),angular.module("Ins").controller("LoginCtrl",["$scope","$window","$location","$rootScope","$auth",function(e,r,t,n,o){e.instagramLogin=function(){o.authenticate("interest").then(function(e){r.localStorage.currentUser=JSON.parse(r.localStorage.currentUser),n.currentUser=JSON.parse(r.localStorage.currentUser),t.path("/")})["catch"](function(e){console.log(e.data)})},e.emailLogin=function(){o.login({email:e.email,password:e.password}).then(function(e){r.localStorage.currentUser=JSON.stringify(e.data.user),n.currentUser=JSON.parse(r.localStorage.currentUser),t.path("/")})["catch"](function(r){e.errorMessage={},angular.forEach(r.data.message,function(t,n){e.loginForm[n].$setValidity("server",!1),e.errorMessage[n]=r.data.message[n]})})}}]),angular.module("Ins").controller("NavbarCtrl",["$scope","$rootScope","$window","$auth",function(e,r,t,n){e.isAuthenticated=function(){return n.isAuthenticated()},e.logout=function(){r.currentUser=null,t.localStorage.currentUser=null,n.logout()}}]),angular.module("Ins").controller("SignupCtrl",["$scope","$location","$auth",function(e,r,t){e.signup=function(){var n={email:e.email,password:e.password};t.signup(n).then(function(e){t.setToken(e),r.path("/")})["catch"](function(r){e.signupForm.email.$setValidity("server",!1),e.errorMessage={},e.errorMessage.email=r.data.message})}}]),angular.module("Ins").factory("API",["$http",function(e){return $serverUrl="https://ins-server.herokuapp.com",{getFeed:function(){return e.get($serverUrl+"/api/feed")},getMediaById:function(r){return e.get($serverUrl+"/api/media/"+r)},likeMedia:function(r){return e.post($serverUrl+"/api/like",{mediaId:r})}}}]),angular.module("Ins").directive("serverError",function(){return{restrict:"A",require:"ngModel",link:function(e,r,t,n){r.on("keydown",function(){n.$setValidity("server",!0)})}}});