/**
 * Instagram Demo
 * (c) 2015 Steven Wang
 * License: MIT
 * Last Updated: Wed, 30 Sep 2015 15:03:16 GMT
 */
angular.module("Ins",["ngRoute","ngMessages","satellizer","environment"]).config(["$routeProvider","envServiceProvider","$authProvider",function(e,t,r){t.config({domains:{development:["localhost:8080","dev.local"],production:["","",""]},vars:{development:{serverUrl:"//localhost:3000",clientUrl:"http://localhost:8080",apiUrl:"//localhost/api",staticUrl:"//localhost/static"},production:{serverUrl:"//localhost:3000",clientUrl:"//localhost:8080",apiUrl:"//",staticUrl:"//"}}}),e.when("/",{templateUrl:"view/home.html",controller:"HomeCtrl"}).when("/login",{templateUrl:"view/login.html",controller:"LoginCtrl"}).when("/signup",{templateUrl:"view/signup.html",controller:"SignupCtrl"}).when("/photo/:id",{templateUrl:"view/detail.html",controller:"DetailCtrl"}).otherwise("/"),t.set("development"),$serverUrl=t.read("serverUrl"),$clientUrl=t.read("clientUrl"),r.loginUrl=$serverUrl+"/auth/login",r.signupUrl=$serverUrl+"/auth/signup",r.oauth2({name:"interest",url:$serverUrl+"/auth/instagram",redirectUri:$clientUrl,clientId:"58394c6d6aae436392eb7898d80d33ea",requiredUrlParams:["scope"],scope:["likes"],scopeDelimiter:"+",authorizationEndpoint:"https://api.instagram.com/oauth/authorize"})}]).run(["$rootScope","$window","$auth",function(e,t,r){r.isAuthenticated()&&t.localStorage.currentUser&&(e.currentUser=JSON.parse(t.localStorage.currentUser))}]),angular.module("Ins").controller("DetailCtrl",["$scope","$rootScope","$location","API",function(e,t,r,o){var n=r.path().split("/").pop();o.getMediaById(n).success(function(t){e.hasLiked=t.user_has_liked,e.photo=t}),e.like=function(){e.hasLiked=!0,o.likeMedia(n).error(function(e){sweetAlert("Error",e.message,"error")})}}]),angular.module("Ins").controller("HomeCtrl",["$scope","$window","$rootScope","$auth","API",function(e,t,r,o,n){o.isAuthenticated()&&r.currentUser&&r.currentUser.username&&n.getFeed().success(function(t){e.photos=t}),e.isAuthenticated=function(){return o.isAuthenticated()},e.linkInstagram=function(){o.link("interest").then(function(o){t.localStorage.currentUser=JSON.stringify(o.data.user),r.currentUser=JSON.parse(t.localStorage.currentUser),n.getFeed().success(function(t){e.photos=t})["catch"](function(e){console.log(e)})})}}]),angular.module("Ins").controller("LoginCtrl",["$scope","$window","$location","$rootScope","$auth",function(e,t,r,o,n){e.instagramLogin=function(){n.authenticate("interest").then(function(e){t.localStorage.currentUser=JSON.parse(t.localStorage.currentUser),o.currentUser=JSON.parse(t.localStorage.currentUser),r.path("/")})["catch"](function(e){console.log(e.data)})},e.emailLogin=function(){n.login({email:e.email,password:e.password}).then(function(e){t.localStorage.currentUser=JSON.stringify(e.data.user),o.currentUser=JSON.parse(t.localStorage.currentUser),r.path("/")})["catch"](function(t){e.errorMessage={},angular.forEach(t.data.message,function(r,o){e.loginForm[o].$setValidity("server",!1),e.errorMessage[o]=t.data.message[o]})})}}]),angular.module("Ins").controller("NavbarCtrl",["$scope","$rootScope","$window","$auth",function(e,t,r,o){e.isAuthenticated=function(){return o.isAuthenticated()},e.logout=function(){o.logout(),delete r.localStorage.currentUser}}]),angular.module("Ins").controller("SignupCtrl",["$scope","$location","$auth",function(e,t,r){e.signup=function(){var o={email:e.email,password:e.password};r.signup(o).then(function(e){r.setToken(e),t.path("/")})["catch"](function(e){console.log(e.data)})}}]),angular.module("Ins").factory("API",["$http",function(e){return{getFeed:function(){return e.get("http://localhost:3000/api/feed")},getMediaById:function(t){return e.get("http://localhost:3000/api/media/"+t)},likeMedia:function(t){return e.post("http://localhost:3000/api/like",{mediaId:t})}}}]),angular.module("Ins").directive("serverError",function(){return{restrict:"A",require:"ngModel",link:function(e,t,r,o){t.on("keydown",function(){o.$setValidity("server",!0)})}}});